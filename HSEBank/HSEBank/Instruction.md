# HSEBank – инструкция по эксплуатации консольного приложения

## 1. Назначение

Приложение **HSEBank** предназначено для простого учёта личных финансов. Основные возможности:

- хранение списка счетов и их текущих балансов;
- учёт доходов и расходов по категориям;
- просмотр аналитики и формирование отчётов;
- импорт и экспорт данных для сохранения между запусками.

Все операции выполняются через консольное меню.

---

## 2. Запуск приложения

1. Откройте проект в IDE или через терминал.
2. Соберите и запустите проект (например, с помощью команды сборки IDE или `dotnet run` в терминале).
3. После запуска на экране появится главное меню приложения.

---

## 3. Общие принципы работы

- Все данные в рамках одного запуска хранятся в памяти.  
  Чтобы сохранить их между запусками, необходимо выполнить **экспорт** и затем при следующем запуске выполнить **импорт**.
- Любое действие (создание, удаление, редактирование) реализовано как **команда**:
    - команда выполняется;
    - сохраняется в историю;
    - при наличии поддержки может быть отменена через пункт «Undo».
- Выполнение команд:
    - логируется (в консоль выводится начало и завершение операции);
    - сопровождается замером времени (в миллисекундах).

---

## 4. Главное меню

После запуска приложения отображается меню:

1. Счета
2. Операции
3. Категории
4. Аналитика
5. Отчёт
6. Импорт / Экспорт данных
7. Пересчёт баланса
8. Показать историю команд
9. Undo
10. Выход

Для выбора пункта введите соответствующую цифру и нажмите **Enter**.

---

## 5. Работа со счетами

Выберите пункт **«1. Счета»**.

Доступны операции:

### 5.1. Создание счёта

1. Введите название счёта (например, «Карта Тинькофф»).
2. Введите стартовый баланс (может быть 0, но не может быть отрицательным).
3. Если начальный баланс > 0:
    - создаётся служебная категория «Начальный баланс» (тип **Income**);
    - создаётся операция-доход на указанную сумму;
    - баланс счёта пересчитывается по всем операциям.
4. Команда поддерживает Undo: при отмене счёт и связанная начальная операция удаляются.

### 5.2. Просмотр счетов

- Выводится список всех счетов:
    - название;
    - текущий баланс (по данным операций).

### 5.3. Удаление счёта

1. Выберите счёт по номеру из списка.
2. Счёт будет удалён, в консоль попадёт соответствующее событие.
3. Операция поддерживает Undo:
    - при отмене счёт восстанавливается;
    - баланс пересчитывается по связанным операциям.

### 5.4. Редактирование счёта

1. Выберите счёт.
2. Введите новое имя (или оставьте прежнее).
3. Команда поддерживает Undo: при отмене возвращается исходное имя.

---

## 6. Работа с категориями

Выберите пункт **«3. Категории»**.

Доступны операции:

### 6.1. Добавление категории

1. Введите название категории (например, «Еда», «Зарплата»).
2. Выберите тип:
    - `1` – **Доход (Income)**;
    - `2` – **Расход (Expense)**.
3. Категория создаётся, если ещё не существует категории с тем же именем и типом.
4. Операция поддерживает Undo: при отмене категория удаляется.

### 6.2. Просмотр категорий

- Отображаются строки вида:  
  `Еда (Expense)`, `Зарплата (Income)` и т.п.

### 6.3. Редактирование категории

1. Выберите категорию по номеру.
2. Введите новое имя (или оставьте пустым, чтобы сохранить текущее).
3. Выберите новый тип (или сохраните прежний).
4. Операция поддерживает Undo: можно вернуться к исходному имени и типу.

### 6.4. Удаление категории

1. Выберите категорию по номеру.
2. Категория будет удалена.
3. При Undo категория воссоздаётся с прежним именем и типом.

---

## 7. Работа с операциями

Выберите пункт **«2. Операции»**.

### 7.1. Добавление операции

1. Выберите счёт, к которому относится операция.
2. Выберите тип:
    - `1` – Доход (**Income**);
    - `2` – Расход (**Expense**).
3. Выберите категорию:
    - при наличии категорий нужного типа – выберите одну по номеру;
    - либо выберите `0` и создайте новую категорию по имени.
4. Введите сумму (строго > 0).
5. Введите описание (опционально).
6. Операция будет создана:
    - публикуется событие `OperationCreatedEvent`;
    - обработчик `BalanceUpdateHandler` пересчитывает баланс счёта;
    - в консоль выводится обновлённый баланс.

Операция добавления поддерживает Undo: при отмене операция удаляется, баланс пересчитывается.

### 7.2. Просмотр операций

- Отображается список операций, например:
  10.01.2025 | Income  |    200,00 | категория: Зарплата | Премия
  11.01.2025 | Expense |     50,00 | категория: Еда      | Обед
- - Для каждой операции видно:
- дату;
- тип (Доход / Расход);
- сумму;
- категорию;
- описание.

### 7.3. Редактирование операции

1. Выберите операцию из списка.
2. При необходимости измените:
- тип (Доход / Расход);
- сумму;
- категорию (оставить прежнюю или выбрать/создать новую);
- описание.
3. После сохранения баланс счёта пересчитывается через `OperationFacade`.

Операция поддерживает Undo – можно вернуть прежние значения типа, суммы, категории и описания.

### 7.4. Удаление операции

1. Выберите операцию.
2. Операция будет удалена, баланс счёта пересчитается.
3. При Undo операция создаётся заново с прежними полями, затем выполняется пересчёт баланса.

---

## 8. Аналитика

Выберите пункт **«4. Аналитика»**.

1. Укажите период:
- дату начала (формат `yyyy-MM-dd`);
- дату окончания (формат `yyyy-MM-dd`).
2. Приложение отфильтрует операции по указанным датам.
3. Выберите стратегию аналитики:
- `1` – **Доходы vs Расходы**  
  Показывает суммарные доходы, расходы и чистый баланс за период.
- `2` – **По категориям**  
  Группировка по категориям и типу (например, `Еда, Expense`) с подсчётом баланса по каждой.
- `3` – **По месяцам**  
  Группировка по месяцам (формат `yyyy-MM`) с итоговыми значениями.

Результат выводится в текстовом виде: заголовок, строки с данными и общий итог.

Запуск аналитики оборачивается декоратором времени: в конце показывается длительность выполнения в миллисекундах.  
Команда аналитики не поддерживает Undo (операция только читает данные).

---

## 9. Отчёт

Выберите пункт **«5. Отчёт»**.

- Формируется форматированный отчёт на основе аналитики по категориям:
- заголовок (например, «Аналитика по категориям и типу»);
- табличная часть вида «категория → сумма»;
- итоговая строка с общей суммой.
- Отчёт выводится в консоль единым блоком, визуально отделённым линиями.

Если операций нет, приложение сообщит, что построить отчёт невозможно.

---

## 10. Импорт и экспорт данных

Выберите пункт **«6. Импорт / Экспорт данных»**.

Далее:

1. Выберите режим:
- `1` – Экспорт;
- `2` – Импорт.
2. Укажите формат: `CSV`, `JSON` или `YAML` (регистр значения не имеет).

### 10.1. Экспорт

- **CSV**:
- укажите папку;
- в неё будут сохранены файлы:
    - `accounts.csv`;
    - `operations.csv`;
    - `categories.csv`.
- **JSON / YAML**:
- укажите путь к файлу (например, `data.json`);
- все данные (счета, операции, категории) экспортируются в один файл.

Экспорт реализован как команда и формально поддерживает Undo (состояние программы при экспорте не изменяется; файлы при Undo не удаляются).

### 10.2. Импорт

- **CSV**:
- укажите папку с файлами `accounts.csv`, `operations.csv`, `categories.csv`.
- **JSON / YAML**:
- укажите путь к файлу с данными.

При импорте:

- сущности читаются из файлов;
- по имеющимся `Id` записи обновляются или создаются заново;
- для отсутствующих `Id` генерируются новые `Guid`.

После завершения отображается итог, например:

> Импортировано: X счетов, Y операций, Z категорий.

Импорт также оформлен как команда; Undo не удаляет импортированные данные (демонстрационный режим), но сам факт выполнения фиксируется в истории.

---

## 11. Пересчёт баланса

Выберите пункт **«7. Пересчёт баланса»**.

Доступны варианты:

1. **Автоматический по всем счетам**
- для каждого счёта суммируются операции:
    - доходы добавляются;
    - расходы вычитаются;
- по завершении выводится сообщение об успешном пересчёте.

2. **Ручной по выбранному счёту**
- выберите нужный счёт;
- баланс пересчитается только для него.

Обе операции реализованы как команды. Undo формально поддерживается, но пересчёт сам по себе является чистой функцией от списка операций.

---

## 12. История команд и Undo

### 12.1. История команд

Пункт **«8. Показать историю команд»**:

- отображает все команды, выполненные через `CommandManager`, в обратном порядке (сначала последние).
- имена команд содержат суффиксы `time/logged`, отражающие применение декораторов.

Это удобно для отладки и понимания последовательности действий пользователя.

### 12.2. Undo

Пункт **«9. Undo»**:

- отменяет последнюю команду в истории, если у неё реализован метод `Undo()`;
- если история пуста, выводится сообщение:  
  «История пуста. Отменять нечего.»
- если команда не поддерживает отмену (например, аналитика), при вызове `Undo()` выводится сообщение:  
  «Отмена не поддерживается для этой команды.»

---

## 13. Завершение работы

Пункт **«0. Выход»**:

- завершает основной цикл `Start()` и закрывает приложение.
- данные, находящиеся в памяти, теряются.  
  Чтобы сохранить их, перед выходом выполните экспорт данных.